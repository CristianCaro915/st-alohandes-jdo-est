--______________________________________________________________________________________________________
--CREACIÓN DE TABLAS CON RESTRICCIONES BÁSICAS
--______________________________________________________________________________________________________
CREATE TABLE HOTEL(
    ID_HT NUMBER(5),
    NOMBRE VARCHAR2(15) NOT NULL,
    TIPO VARCHAR2(25)NOT NULL);

CREATE TABLE HOSTAL(
    ID_HS NUMBER(5),
    NOMBRE VARCHAR2(15)NOT NULL,
    RECEPCION NUMBER(5) NOT NULL, 
    HORACIERRE DATE NOT NULL,
    HORAAPERTURA DATE NOT NULL,
    TIPO VARCHAR2(25) NOT NULL);

CREATE TABLE PROPIETARIOINMUEBLE(
    ID_PI NUMBER(5),
    NOMBRE VARCHAR2(15)NOT NULL,
    VINCULO VARCHAR2(15)NOT NULL,
    TIPO VARCHAR2(25) NOT NULL);

CREATE TABLE EMPRESA(
    ID_E NUMBER(5),
    NOMBRE VARCHAR2(15) NOT NULL,
    TIPO VARCHAR2(25) NOT NULL);

CREATE TABLE CLIENTE(
    ID_CL NUMBER(5),
    NOMBRE VARCHAR2(15) NOT NULL,
    CORREO VARCHAR2(25) NOT NULL,
    CONTRASENIA VARCHAR2(20) NOT NULL);
    
CREATE TABLE OFERTA(
    ID_O NUMBER(5),
    RESERVADO NUMBER(5) NOT NULL,
    ID_CLIENTE NUMBER(5),
    ID_PROPIETARIOI NUMBER(5),
    ID_EMPRESA NUMBER(5),
    ID_HOSTAL NUMBER(5),
    ID_HOTEL NUMBER(5),
    DISPONIBILIDAD NUMBER(5)NOT NULL );    

CREATE TABLE CONTRATO(
    ID_C NUMBER(5),
    TIPOCONTRATO VARCHAR2(10) NOT NULL,
    DURACION NUMBER(5) NOT NULL,
    DURACIONPREPAID NUMBER(5),
    PRECIOESPECIAL NUMBER(5),
    PRECIOFINAL NUMBER(5) NOT NULL,
    FECHAINICIO DATE NOT NULL,
    FECHAPAGO NUMBER(5) NOT NULL,
    ID_OFERTA NUMBER(5));
    
CREATE TABLE INMUEBLE(
    ID_I NUMBER(5),
    TIPOI VARCHAR2(15) NOT NULL,
    UBICACION VARCHAR2(10) NOT NULL, 
    COSTOADMIN NUMBER(5) NOT NULL,
    NUMHABITACIONES NUMBER(5) NOT NULL,
    ID_OFERTA NUMBER(5));
    
CREATE TABLE SEGURO(
    ID_S NUMBER(5),
    FECHAVENCE DATE NOT NULL,
    DESCRIPCION VARCHAR2(25) NOT NULL,
    ID_INMUEBLE NUMBER(5));

CREATE TABLE HABITACION(
    ID_H NUMBER(5),
    TAMANIO NUMBER(5),
    TIPOH VARCHAR2(10),
    PRECIOFINAL NUMBER(5),
    UBICACION VARCHAR2(10),
    ID_OFERTA NUMBER(5),
    ID_CONTRATO NUMBER(5),
    ID_INMUEBLE NUMBER(5));

CREATE TABLE SERVICIO(
    ID_SH NUMBER(5),
    PRECIO NUMBER(5) NOT NULL, 
    INCLUIDO NUMBER(5) NOT NULL,
    CANTIDAD NUMBER(5) NOT NULL,
    NOMBRE VARCHAR2(20) NOT NULL);

--______________________________________________________________________________________________________
--AÑADIR RESTRICCIONES INICIALES
--______________________________________________________________________________________________________
ALTER TABLE HOTEL ADD CONSTRAINT PK_HOTEL PRIMARY KEY (ID_HT) ENABLE;
ALTER TABLE HOTEL ADD CONSTRAINT CK1_HOTEL CHECK 
(TIPO IN ('PERSONANAT','PROPIETARIOI','SUJETOC','HOTEL','HOSTAL')) ENABLE;

ALTER TABLE HOSTAL ADD CONSTRAINT PK_HOSTAL PRIMARY KEY (ID_HS) ENABLE;
ALTER TABLE HOSTAL ADD CONSTRAINT CK_HOSTAL CHECK (RECEPCION IN (0,1)) ENABLE;
ALTER TABLE HOSTAL ADD CONSTRAINT CK_HOSTAL_TIME CHECK (HORAAPERTURA<HORACIERRE) ENABLE; 
ALTER TABLE HOSTAL ADD CONSTRAINT CK1_HOSTAL CHECK 
(TIPO IN ('PERSONANAT','PROPIETARIOI','SUJETOC','HOTEL','HOSTAL','EMPRESA')) ENABLE;

ALTER TABLE PROPIETARIOINMUEBLE ADD CONSTRAINT PK_PROPIETARIOINMUEBLE PRIMARY KEY (ID_PI) ENABLE;
ALTER TABLE PROPIETARIOINMUEBLE ADD CONSTRAINT CK_PROPIETARIOINMUEBLE CHECK 
(VINCULO IN ('PROFESOR','EMPLEADO','PADRE','ESTUDIANTE','EGRESADO','VECINO','PADREFAMILIA')) ENABLE;
ALTER TABLE PROPIETARIOINMUEBLE ADD CONSTRAINT CK2_PROPIETARIOINMUEBLE CHECK 
(TIPO IN ('PERSONANAT','PROPIETARIOI','SUJETOC','HOTEL','HOSTAL','EMPRESA')) ENABLE;

ALTER TABLE EMPRESA ADD CONSTRAINT PK_EMPRESA PRIMARY KEY (ID_E) ENABLE;
ALTER TABLE EMPRESA ADD CONSTRAINT CK_EMPRESA CHECK 
(TIPO IN ('PERSONANAT','PROPIETARIOI','SUJETOC','HOTEL','HOSTAL')) ENABLE;

ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE PRIMARY KEY (ID_CL) ENABLE;

ALTER TABLE OFERTA ADD CONSTRAINT PK_OFERTA PRIMARY KEY (ID_O) ENABLE;
ALTER TABLE OFERTA ADD CONSTRAINT CK_OFERTA CHECK (RESERVADO IN (0,1)) ENABLE;
ALTER TABLE OFERTA ADD CONSTRAINT CK2_OFERTA CHECK (DISPONIBILIDAD IN (0,1)) ENABLE;

ALTER TABLE CONTRATO ADD CONSTRAINT PK_CONTRATO PRIMARY KEY (ID_C) ENABLE;
ALTER TABLE CONTRATO ADD CONSTRAINT CK_CONTRATO CHECK (TIPOCONTRATO IN ('DIARIO','MENSUAL','ANUAL')) ENABLE;
ALTER TABLE CONTRATO ADD CONSTRAINT CK2_CONTRATO CHECK (FECHAPAGO BETWEEN 1 AND 30) ENABLE;

ALTER TABLE INMUEBLE ADD CONSTRAINT PK_INMUEBLE PRIMARY KEY (ID_I) ENABLE;
ALTER TABLE INMUEBLE ADD CONSTRAINT CK_INMUEBLE CHECK (TIPOI IN ('VIVIENDA','APARTAMENTO')) ENABLE;

ALTER TABLE HABITACION ADD CONSTRAINT PK_HABITACION PRIMARY KEY (ID_H) ENABLE;
ALTER TABLE HABITACION ADD CONSTRAINT CH_HABITACIOON CHECK (TIPOH IN ('COMPARTIDO','INDIVIDUAL','ESTANDAR','SUITE','SEMISUITE')) ENABLE;

ALTER TABLE SEGURO ADD CONSTRAINT PK_SEGURO PRIMARY KEY (ID_S) ENABLE;

ALTER TABLE SERVICIO ADD CONSTRAINT PK_SERVICIO PRIMARY KEY (ID_SH) ENABLE;
ALTER TABLE SERVICIO ADD CONSTRAINT CK_SERVICIO CHECK(NOMBRE IN ('SALA','JACUZZI','COCINETA','BAÑOCOMPARTIDO','TVCABLE','AMOBLADO',
'AGUA','LUZ','GAS','INTERNET','TELEFONIA','PISCINA','RESTAURANTE','PARQUEADERO','RECEPCION24','SALAESTUDIO','GIMNASIO','SALASOCIAL')) ENABLE; 
ALTER TABLE SERVICIO ADD CONSTRAINT CK2_SERVICIO CHECK(INCLUIDO IN (0,1));

--______________________________________________________________________________________________________
--AÑADIR FOREIGN KEYS
--______________________________________________________________________________________________________

ALTER TABLE OFERTA ADD CONSTRAINT FK_O_ID_CLIENTE FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CL) ENABLE;
ALTER TABLE OFERTA ADD CONSTRAINT FK_O_ID_PROPIETARIOI FOREIGN KEY (ID_PROPIETARIOI) REFERENCES PROPIETARIOINMUEBLE(ID_PI) ENABLE;
ALTER TABLE OFERTA ADD CONSTRAINT FK_O_ID_EMPRESA FOREIGN KEY (ID_EMPRESA) REFERENCES EMPRESA(ID_E) ENABLE;
ALTER TABLE OFERTA ADD CONSTRAINT FK_O_ID_HOSTAL FOREIGN KEY (ID_HOSTAL) REFERENCES HOSTAL(ID_HS) ENABLE;
ALTER TABLE OFERTA ADD CONSTRAINT FK_O_ID_HOTEL FOREIGN KEY (ID_HOTEL) REFERENCES HOTEL(ID_HT) ENABLE;

ALTER TABLE CONTRATO ADD CONSTRAINT FK_C_ID_OFERTA FOREIGN KEY (ID_OFERTA) REFERENCES OFERTA (ID_O) ENABLE;

ALTER TABLE INMUEBLE ADD CONSTRAINT FK_I_ID_OFERTA FOREIGN KEY (ID_OFERTA) REFERENCES OFERTA(ID_O) ENABLE;

ALTER TABLE SEGURO ADD CONSTRAINT FK_S_ID_INMUEBLE FOREIGN KEY (ID_INMUEBLE) REFERENCES INMUEBLE(ID_I) ENABLE; 

ALTER TABLE HABITACION ADD CONSTRAINT FK_H_ID_OFERTA FOREIGN KEY (ID_OFERTA) REFERENCES OFERTA (ID_O) ENABLE;
ALTER TABLE HABITACION ADD CONSTRAINT FK_H_ID_CONTRATO FOREIGN KEY (ID_CONTRATO) REFERENCES CONTRATO (ID_C) ENABLE;
ALTER TABLE HABITACION ADD CONSTRAINT FK_H_ID_INMUEBLE FOREIGN KEY (ID_INMUEBLE) REFERENCES INMUEBLE (ID_I) ENABLE;

--CREADA LUEGO DE LA ASIGNACION DE PKS
CREATE TABLE BRINDAN(
    ID_HABITACION NUMBER(5) CONSTRAINT FK_ID_HABITACION REFERENCES HABITACION (ID_H),
    ID_SERVICIO NUMBER(5) CONSTRAINT FK_ID_SERVICIO REFERENCES SERVICIO (ID_SH),
    CONSTRAINT PK_BRINDAN PRIMARY KEY (ID_HABITACION,ID_SERVICIO));